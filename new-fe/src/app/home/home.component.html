<div class="home-container">
  <!-- Search and Filter Section -->
  <div class="search-filter-section">
    <!-- Search Bar -->
    <div class="search-bar-wrapper">
      <p-iconField iconPosition="left" class="search-field">
        <p-inputIcon class="pi pi-search"></p-inputIcon>
        <input
          type="text"
          pInputText
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event); onSearchChange()"
          placeholder="Search by location, age, interests..."
          class="search-input" />
      </p-iconField>
      <button
        pButton
        type="button"
        icon="pi pi-refresh"
        class="p-button-text p-button-rounded refresh-btn"
        (click)="onRefresh()"
        pTooltip="Refresh">
      </button>
    </div>

    <!-- Filter Buttons -->
    <div class="filter-pills">
      @for (filter of filterOptions; track filter.value) {
        <button
          pButton
          type="button"
          [label]="filter.label"
          class="filter-pill"
          [class.active]="currentFilter() === filter.value"
          (click)="onFilterChange(filter.value)">
        </button>
      }
    </div>

    <!-- Advanced Filters Section -->
    <div class="advanced-filters-section">
      <span class="filters-info">
        <i class="pi pi-filter"></i>
        Want more filtering options?
      </span>
      <a class="advanced-link" (click)="goToAdvancedSearch()">
        Open Advanced Filters
      </a>
    </div>
  </div>

  <!-- Sort Dropdown (Hidden by default, can be toggled) -->
  @if (false) {
    <div class="sort-section">
      <p-select
        [options]="sortOptions"
        [ngModel]="currentSort()"
        (ngModelChange)="currentSort.set($event); onSortChange({ value: $event })"
        (onChange)="onSortChange($event)"
        optionLabel="label"
        optionValue="value"
        placeholder="Sort by">
      </p-select>
    </div>
  }

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <p-progressSpinner class="w-4rem h-4rem"></p-progressSpinner>
      <p>Loading users...</p>
    </div>
  }
  @if (isLoading()) {
    <div class="loading-container">
      <p-progressSpinner class="w-4rem h-4rem"></p-progressSpinner>
      <p>Loading users...</p>
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && users().length === 0) {
    <div class="empty-state">
      <i class="pi pi-users empty-icon"></i>
      <h3>No Users Found</h3>
      <p>Try changing your filters or check back later.</p>
      <button
        pButton
        type="button"
        label="Reset Filters"
        icon="pi pi-filter-slash"
        class="p-button-outlined"
        (click)="onFilterChange('all')">
      </button>
    </div>
  }

  <!-- User Grid -->
  @if (!isLoading() && users().length > 0) {
    <div class="users-grid" (scroll)="onScroll($event)">
      @for (user of users(); track trackByUserId($index, user)) {
        <app-user-card
          [user]="user"
          (chatClick)="onChatClick(user)"
          (cardClick)="onCardClick(user)"
          (giftClick)="onGiftClick(user)">
        </app-user-card>
      }
    </div>
  }

  <!-- Loading More Indicator -->
  @if (isLoadingMore()) {
    <div class="loading-more">
      <p-progressSpinner
        class="w-3rem h-3rem"
        strokeWidth="4"
        animationDuration="1s">
      </p-progressSpinner>
      <p>Loading more users...</p>
    </div>
  }

  <!-- End of Results -->
  @if (!isLoading() && !hasMoreData() && users().length > 0) {
    <div class="end-of-results">
      <i class="pi pi-check-circle"></i>
      <p>You've reached the end! Showing all {{ totalUsers() }} users.</p>
    </div>
  }
  @if (!isLoading() && !hasMoreData() && users().length > 0) {
    <div class="end-of-results">
      <i class="pi pi-check-circle"></i>
      <p>You've reached the end! Showing all {{ totalUsers() }} users.</p>
    </div>
  }
</div>

<!-- Gift Send Dialog -->
<app-send-gift-dialog
  [visible]="showSendGiftDialog()"
  (visibleChange)="showSendGiftDialog.set($event)"
  [recipientUser]="selectedUserForGift()"
  [visible]="showSendGiftDialog()"
  (visibleChange)="showSendGiftDialog.set($event)"
  [recipientUser]="selectedUserForGift()"
  (giftSent)="onGiftSent($event)">
</app-send-gift-dialog>

<!-- Toast Messages -->
<p-toast></p-toast>


