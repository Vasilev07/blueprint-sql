<div class="advanced-search-container">
  <!-- Header -->
  <div class="search-header">
    <button 
      pButton 
      type="button" 
      icon="pi pi-arrow-left" 
      class="p-button-text p-button-rounded back-btn"
      (click)="goBack()"
      pTooltip="Back to Home">
    </button>
    <h2 class="header-title">
      <i class="pi pi-filter"></i>
      Advanced Filters
    </h2>
    <button 
      pButton 
      type="button" 
      label="Reset All" 
      class="reset-all-btn"
      (click)="resetAllFilters()">
    </button>
  </div>

  <!-- Filters Panel -->
  <div class="filters-panel">
    <div class="filters-grid">
      <!-- Gender Filter -->
      <div class="filter-group">
        <label class="filter-label">Gender</label>
        <p-dropdown
          [options]="genderOptions"
          [(ngModel)]="filters.gender"
          (onChange)="onFilterChange()"
          optionLabel="label"
          optionValue="value"
          [style]="{'width': '100%'}"
          styleClass="custom-dropdown">
        </p-dropdown>
      </div>

      <!-- Online Status Filter -->
      <div class="filter-group">
        <label class="filter-label">Online Status</label>
        <p-dropdown
          [options]="onlineStatusOptions"
          [(ngModel)]="filters.onlineStatus"
          (onChange)="onFilterChange()"
          optionLabel="label"
          optionValue="value"
          [style]="{'width': '100%'}"
          styleClass="custom-dropdown">
        </p-dropdown>
      </div>

      <!-- Relationship Status Filter -->
      <div class="filter-group">
        <label class="filter-label">Relationship Status</label>
        <p-dropdown
          [options]="relationshipStatusOptions"
          [(ngModel)]="filters.relationshipStatus"
          (onChange)="onFilterChange()"
          optionLabel="label"
          optionValue="value"
          [style]="{'width': '100%'}"
          styleClass="custom-dropdown">
        </p-dropdown>
      </div>

      <!-- Interests Filter -->
      <div class="filter-group">
        <label class="filter-label">Interests</label>
        <p-multiSelect
          [options]="interestsOptions"
          [(ngModel)]="filters.interests"
          (onChange)="onFilterChange()"
          optionLabel="label"
          optionValue="value"
          placeholder="All interests"
          [style]="{'width': '100%'}"
          styleClass="custom-multiselect"
          display="chip">
        </p-multiSelect>
      </div>
    </div>

    <!-- Age Range Slider -->
    <div class="filter-group slider-group">
      <label class="filter-label">Age Range: {{ ageRangeLabel }}</label>
      <p-slider
        [(ngModel)]="filters.ageRange"
        (onSlideEnd)="onAgeRangeChange($event)"
        [range]="true"
        [min]="18"
        [max]="65"
        styleClass="custom-slider">
      </p-slider>
    </div>

    <!-- Distance Slider -->
    <div class="filter-group slider-group">
      <label class="filter-label">Distance: {{ distanceLabel }}</label>
      <p-slider
        [(ngModel)]="filters.distance"
        (onSlideEnd)="onDistanceChange($event)"
        [min]="1"
        [max]="500"
        styleClass="custom-slider">
      </p-slider>
    </div>

    <!-- Location Input -->
    <div class="filter-group">
      <label class="filter-label">Location</label>
      <p-iconField iconPosition="left">
        <p-inputIcon styleClass="pi pi-map-marker"></p-inputIcon>
        <input 
          type="text" 
          pInputText 
          [(ngModel)]="filters.location"
          (input)="onFilterChange()"
          placeholder="Enter city or country..."
          class="location-input" />
      </p-iconField>
    </div>

    <!-- Verified Only Checkbox -->
    <div class="filter-group checkbox-group">
      <p-checkbox
        [(ngModel)]="filters.verifiedOnly"
        (onChange)="onFilterChange()"
        [binary]="true"
        inputId="verifiedOnly">
      </p-checkbox>
      <label for="verifiedOnly" class="checkbox-label">
        Show verified users only
      </label>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section">
    <div class="results-header">
      <h3>
        <i class="pi pi-users"></i>
        {{ filteredUsers.length }} {{ filteredUsers.length === 1 ? 'user' : 'users' }} found
      </h3>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <p-progressSpinner styleClass="w-4rem h-4rem"></p-progressSpinner>
      <p>Loading users...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && filteredUsers.length === 0" class="empty-state">
      <i class="pi pi-search empty-icon"></i>
      <h3>No Users Found</h3>
      <p>Try adjusting your filters to see more results.</p>
      <button 
        pButton 
        type="button" 
        label="Reset All Filters" 
        icon="pi pi-filter-slash"
        class="p-button-outlined"
        (click)="resetAllFilters()">
      </button>
    </div>

    <!-- User Grid -->
    <div *ngIf="!isLoading && displayedUsers.length > 0" class="users-grid">
      <app-user-card 
        *ngFor="let user of displayedUsers; trackBy: trackByUserId"
        [user]="user"
        (chatClick)="onChatClick($event)"
        (cardClick)="onCardClick($event)">
      </app-user-card>
    </div>

    <!-- Loading More Indicator -->
    <div *ngIf="isLoadingMore" class="loading-more">
      <p-progressSpinner 
        styleClass="w-3rem h-3rem" 
        strokeWidth="4"
        animationDuration="1s">
      </p-progressSpinner>
      <p>Loading more users...</p>
    </div>

    <!-- End of Results -->
    <div *ngIf="!isLoading && !hasMoreData && displayedUsers.length > 0" class="end-of-results">
      <i class="pi pi-check-circle"></i>
      <p>You've reached the end! Showing all {{ displayedUsers.length }} users.</p>
    </div>
  </div>
</div>

<!-- Toast Messages -->
<p-toast></p-toast>

