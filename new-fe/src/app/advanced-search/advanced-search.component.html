<div class="advanced-search-container">
  <!-- Header -->
  <div class="search-header">
    <button 
      pButton 
      type="button" 
      icon="pi pi-arrow-left" 
      class="p-button-text p-button-rounded back-btn"
      (click)="goBack()"
      pTooltip="Back to Home">
    </button>
    <h2 class="header-title">
      <i class="pi pi-filter"></i>
      Advanced Filters
    </h2>
    <button 
      pButton 
      type="button" 
      label="Reset All" 
      class="reset-all-btn"
      (click)="resetAllFilters()">
    </button>
  </div>

  <!-- Filters Panel -->
  <div class="filters-panel">
    <div class="filters-grid">
      <!-- Gender Filter -->
      <div class="filter-group">
        <label class="filter-label">Gender</label>
        <p-select
          [options]="genderOptions"
          [ngModel]="filters().gender"
          (ngModelChange)="updateFilter('gender', $event); onFilterChange()"
          optionLabel="label"
          optionValue="value"
          [style]="{'width': '100%'}"
          class="custom-dropdown">
        </p-select>
      </div>

      <!-- Online Status Filter -->
      <div class="filter-group">
        <label class="filter-label">Online Status</label>
        <p-select
          [options]="onlineStatusOptions"
          [ngModel]="filters().onlineStatus"
          (ngModelChange)="updateFilter('onlineStatus', $event); onFilterChange()"
          optionLabel="label"
          optionValue="value"
          [style]="{'width': '100%'}"
          class="custom-dropdown">
        </p-select>
      </div>

      <!-- Relationship Status Filter -->
      <div class="filter-group">
        <label class="filter-label">Relationship Status</label>
        <p-select
          [options]="relationshipStatusOptions"
          [ngModel]="filters().relationshipStatus"
          (ngModelChange)="updateFilter('relationshipStatus', $event); onFilterChange()"
          optionLabel="label"
          optionValue="value"
          [style]="{'width': '100%'}"
          class="custom-dropdown">
        </p-select>
      </div>

      <!-- Interests Filter -->
      <div class="filter-group">
        <label class="filter-label">Interests</label>
        <p-multiSelect
          [options]="interestsOptions"
          [ngModel]="filters().interests"
          (ngModelChange)="updateFilter('interests', $event); onFilterChange()"
          optionLabel="label"
          optionValue="value"
          placeholder="All interests"
          [style]="{'width': '100%'}"
          class="custom-multiselect"
          display="chip">
        </p-multiSelect>
      </div>
    </div>

    <!-- Age Range Slider -->
    <div class="filter-group slider-group">
      <label class="filter-label">Age Range: {{ ageRangeLabel() }}</label>
      <p-slider
        [ngModel]="filters().ageRange"
        (ngModelChange)="updateFilters({ ageRange: $event })"
        (onSlideEnd)="onAgeRangeChange($event)"
        [range]="true"
        [min]="18"
        [max]="65"
        class="custom-slider">
      </p-slider>
    </div>

    <!-- Distance Slider -->
    <div class="filter-group slider-group">
      <label class="filter-label">Distance: {{ distanceLabel() }}</label>
      <p-slider
        [ngModel]="filters().distance"
        (ngModelChange)="updateFilter('distance', $event)"
        (onSlideEnd)="onDistanceChange($event)"
        [min]="1"
        [max]="500"
        class="custom-slider">
      </p-slider>
    </div>

    <!-- Location Input -->
    <div class="filter-group">
      <label class="filter-label">Location</label>
      <p-iconField iconPosition="left">
        <p-inputIcon class="pi pi-map-marker"></p-inputIcon>
        <input 
          type="text" 
          pInputText 
          [ngModel]="filters().location"
          (ngModelChange)="updateFilter('location', $event); onFilterChange()"
          placeholder="Enter city or country..."
          class="location-input" />
      </p-iconField>
    </div>

    <!-- Verified Only Checkbox -->
    <div class="filter-group checkbox-group">
      <p-checkbox
        [ngModel]="filters().verifiedOnly"
        (ngModelChange)="updateFilter('verifiedOnly', $event); onFilterChange()"
        [binary]="true"
        inputId="verifiedOnly">
      </p-checkbox>
      <label for="verifiedOnly" class="checkbox-label">
        Show verified users only
      </label>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section">
    <div class="results-header">
      <h3>
        <i class="pi pi-users"></i>
        {{ userCountLabel() }}
      </h3>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="loading-container">
      <p-progressSpinner class="w-4rem h-4rem"></p-progressSpinner>
      <p>Loading users...</p>
    </div>
    }

    <!-- Empty State -->
    @if (isEmptyState()) {
    <div class="empty-state">
      <i class="pi pi-search empty-icon"></i>
      <h3>No Users Found</h3>
      <p>Try adjusting your filters to see more results.</p>
      <button 
        pButton 
        type="button" 
        label="Reset All Filters" 
        icon="pi pi-filter-slash"
        class="p-button-outlined"
        (click)="resetAllFilters()">
      </button>
    </div>
    }

    <!-- User Grid -->
    @if (hasUsers()) {
    <div class="users-grid">
      @for (user of users(); track user.id) {
      <app-user-card
        [user]="user"
        (chatClick)="onChatClick($event)"
        (cardClick)="onCardClick($event)"
        (giftClick)="onGiftClick($event)">
      </app-user-card>
      }
    </div>
    }

    <!-- Loading More Indicator -->
    @if (isLoadingMore()) {
    <div class="loading-more">
      <p-progressSpinner 
        class="w-3rem h-3rem" 
        strokeWidth="4"
        animationDuration="1s">
      </p-progressSpinner>
      <p>Loading more users...</p>
    </div>
    }

    <!-- End of Results -->
    @if (showEndOfResults()) {
    <div class="end-of-results">
      <i class="pi pi-check-circle"></i>
      <p>You've reached the end! Showing all {{ totalUsers() }} users.</p>
    </div>
    }
  </div>
</div>

<!-- Gift Send Dialog -->
<app-send-gift-dialog
  [visible]="showSendGiftDialog()"
  (visibleChange)="showSendGiftDialog.set($event)"
  [recipientUser]="selectedUserForGift()"
  (giftSent)="onGiftSent($event)">
</app-send-gift-dialog>

<!-- Toast Messages -->
<p-toast></p-toast>
