/**
 * PrimeNG 21 migration overrides:
 * - Opaque modals/dialogs only (no transparency)
 * - Ensure host elements (p-table, p-button) display correctly so theme applies
 * - Reinforce table and button styles so theme cascades
 */

/* --- Layout Topbar: ensure dark theme background --- */
.layout-theme-dark {
  .layout-topbar {
    background-color: #1f2937 !important;
    background: #1f2937 !important;
  }
}

/* --- Host elements: must display so theme styles apply --- */
p-table,
p-table.p-datatable {
  display: block;
}

p-button {
  display: inline-flex;
}

/* --- Tables: ensure root and inner structure get theme --- */
.p-datatable,
p-table.p-datatable {
  background: var(--surface-ground, #111827);
  color: var(--text-color);
}

.p-datatable .p-datatable-table {
  border-collapse: collapse;
  width: 100%;
}

.p-datatable .p-datatable-thead > tr > th,
.p-datatable .p-datatable-tbody > tr > td,
.p-datatable .p-datatable-tfoot > tr > td {
  border: 1px solid var(--surface-border, rgba(255, 255, 255, 0.1));
  padding: 1rem;
  text-align: left;
}

.p-datatable .p-datatable-thead > tr > th {
  background: var(--surface-100, #1f2937);
  font-weight: 700;
  color: var(--text-color);
}

.p-datatable .p-datatable-tbody > tr {
  background: var(--surface-card, #1f2937);
  color: var(--text-color);
}

.p-datatable .p-datatable-tbody > tr:hover {
  background: var(--surface-hover, rgba(255, 255, 255, 0.03));
}

/* --- Buttons: ensure theme applies (reinforce, don't replace) --- */
button.p-button,
.p-button,
p-button .p-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 1.25rem;
  font-size: 1rem;
  font-weight: 500;
  border-radius: var(--border-radius, 6px);
  transition: background-color 0.2s, color 0.2s, border-color 0.2s, box-shadow 0.2s;
  cursor: pointer;
  border: 1px solid transparent;
}

button.p-button:not(.p-button-text):not(.p-button-outlined),
.p-button:not(.p-button-text):not(.p-button-outlined) {
  background: var(--primary-color, #818cf8);
  color: var(--primary-color-text, #030712);
  border-color: var(--primary-color, #818cf8);
}

button.p-button:not(.p-button-text):not(.p-button-outlined):hover:not(:disabled),
.p-button:not(.p-button-text):not(.p-button-outlined):hover:not(:disabled) {
  background: var(--primary-hover-color, var(--primary-color));
  border-color: var(--primary-hover-color, var(--primary-color));
  color: var(--primary-color-text, #030712);
}

.p-button-label,
.p-button .p-button-label {
  opacity: 1;
}

.p-button-icon,
.p-button .p-button-icon {
  opacity: 1;
}

/* --- Dialogs / Modals: force opaque panel only --- */
.p-dialog,
p-dialog .p-dialog {
  opacity: 1 !important;
  background: var(--surface-overlay, #1f2937) !important;
}

.p-dialog .p-dialog-header,
.p-dialog .p-dialog-content,
.p-dialog .p-dialog-footer {
  background: var(--surface-overlay, #1f2937) !important;
  opacity: 1 !important;
}

.p-component-overlay.p-dialog-mask {
  background-color: rgba(0, 0, 0, 0.5) !important;
}

.p-dialog.p-confirm-dialog .p-dialog-content,
.p-dialog.p-dialog-confirm .p-dialog-content {
  background: var(--surface-overlay, #1f2937) !important;
}

/* --- Input fields: ensure dark theme backgrounds in dark mode --- */
/* Override PrimeNG input styles to ensure dark backgrounds ONLY in dark theme */
/* Scoped to .layout-theme-dark to avoid affecting light theme inputs */

.layout-theme-dark {
  /* Base input styles - only in dark theme */
  input.p-inputtext,
  .p-inputtext,
  input.search-input,
  .search-input {
    background: var(--surface-100, #374151) !important;
    background-color: var(--surface-100, #374151) !important;
    color: var(--text-color, rgba(255, 255, 255, 0.87)) !important;
    border-color: var(--surface-border, rgba(255, 255, 255, 0.1)) !important;
    
    &::placeholder {
      color: var(--text-color-secondary, rgba(255, 255, 255, 0.6)) !important;
    }
    
    &:enabled:hover,
    &:hover {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
      border-color: var(--surface-300, #6b7280) !important;
    }
    
    &:enabled:focus,
    &:focus,
    &:focus-visible {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
      border-color: var(--primary-color, #818cf8) !important;
      box-shadow: var(--focus-ring, 0 0 0 0.2rem rgba(129, 140, 248, 0.2)) !important;
    }
  }

  /* Override for filled/component states - higher specificity */
  input.p-inputtext.p-filled,
  input.p-inputtext.p-component,
  input.p-inputtext.p-component.p-filled,
  input.search-input.p-filled,
  .p-input-filled .p-inputtext,
  .p-input-filled input.p-inputtext,
  .p-input-filled input.p-inputtext.p-filled,
  .p-input-filled .p-inputtext.p-filled {
    background: var(--surface-100, #374151) !important;
    background-color: var(--surface-100, #374151) !important;
    
    &:enabled:hover,
    &:hover {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
    }
    
    &:enabled:focus,
    &:focus {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
    }
  }

  /* Override for iconField components */
  p-iconField input.p-inputtext,
  p-iconField .p-inputtext,
  p-iconField input.search-input,
  p-iconField input.p-inputtext.p-filled,
  p-iconField input.search-input.p-filled,
  .p-iconfield input.p-inputtext,
  .p-iconfield input.search-input,
  .p-iconfield-left input.p-inputtext,
  .p-iconfield-left input.search-input,
  .search-field input.p-inputtext,
  .search-field input.search-input,
  .search-field .p-inputtext,
  .search-field .search-input,
  .search-bar-wrapper input.p-inputtext,
  .search-bar-wrapper input.search-input {
    background: var(--surface-100, #374151) !important;
    background-color: var(--surface-100, #374151) !important;
    color: var(--text-color, rgba(255, 255, 255, 0.87)) !important;
    border-color: var(--surface-border, rgba(255, 255, 255, 0.1)) !important;
    
    &::placeholder {
      color: var(--text-color-secondary, rgba(255, 255, 255, 0.6)) !important;
    }
    
    &:enabled:hover,
    &:hover {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
      border-color: var(--surface-300, #6b7280) !important;
    }
    
    &:enabled:focus,
    &:focus,
    &:focus-visible {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
      border-color: var(--primary-color, #818cf8) !important;
      box-shadow: var(--focus-ring, 0 0 0 0.2rem rgba(129, 140, 248, 0.2)) !important;
    }
  }

  /* Textarea styles - ensure dark theme backgrounds in dark mode */
  textarea.p-inputtextarea,
  textarea.p-inputtext,
  textarea.p-inputtextarea.p-inputtext,
  textarea.p-inputtextarea.p-component,
  textarea.p-inputtext.p-component,
  p-textarea textarea,
  p-textarea textarea.p-inputtextarea,
  p-textarea textarea.p-inputtext {
    background: var(--surface-100, #374151) !important;
    background-color: var(--surface-100, #374151) !important;
    color: var(--text-color, rgba(255, 255, 255, 0.87)) !important;
    border-color: var(--surface-border, rgba(255, 255, 255, 0.1)) !important;
    
    &::placeholder {
      color: var(--text-color-secondary, rgba(255, 255, 255, 0.6)) !important;
    }
    
    &:enabled:hover,
    &:hover {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
      border-color: var(--surface-300, #6b7280) !important;
    }
    
    &:enabled:focus,
    &:focus,
    &:focus-visible {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
      border-color: var(--primary-color, #818cf8) !important;
      box-shadow: var(--focus-ring, 0 0 0 0.2rem rgba(129, 140, 248, 0.2)) !important;
    }
  }

  /* Override for filled/component textarea states */
  textarea.p-inputtextarea.p-filled,
  textarea.p-inputtext.p-filled,
  textarea.p-inputtextarea.p-component.p-filled,
  textarea.p-inputtext.p-component.p-filled,
  p-textarea textarea.p-filled,
  p-textarea textarea.p-component.p-filled {
    background: var(--surface-100, #374151) !important;
    background-color: var(--surface-100, #374151) !important;
    
    &:enabled:hover,
    &:hover {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
    }
    
    &:enabled:focus,
    &:focus {
      background: var(--surface-200, #4b5563) !important;
      background-color: var(--surface-200, #4b5563) !important;
    }
  }

  /* Dark theme overrides for send gift dialog sections */
  app-send-gift-dialog {
    .gift-form {
      .selected-gift-summary,
      div.selected-gift-summary,
      .selected-gift-summary.ng-star-inserted {
        background: #374151 !important;
        background-color: #374151 !important;
      }

      .balance-check,
      div.balance-check,
      .balance-check.ng-star-inserted {
        background: #374151 !important;
        background-color: #374151 !important;
      }
    }

    .p-dialog-content .gift-form {
      .selected-gift-summary,
      div.selected-gift-summary {
        background: #374151 !important;
        background-color: #374151 !important;
      }

      .balance-check,
      div.balance-check {
        background: #374151 !important;
        background-color: #374151 !important;
      }
    }

    // Even more specific targeting
    p-dialog .p-dialog-content form.gift-form {
      .selected-gift-summary {
        background: #374151 !important;
        background-color: #374151 !important;
      }

      .balance-check {
        background: #374151 !important;
        background-color: #374151 !important;
      }
    }
  }

  /* Chat component input overrides */
  app-chat {
    .chat-input {
      background: #1f2937 !important;
      background-color: #1f2937 !important;

      .input-container,
      .message-form .input-container {
        background: #374151 !important;
        background-color: #374151 !important;
        border-color: rgba(255, 255, 255, 0.1) !important;

        .message-input,
        input.message-input {
          background: transparent !important;
          background-color: transparent !important;
          color: rgba(255, 255, 255, 0.87) !important;

          &::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
          }
        }
      }
    }
  }

  /* Chat home sidebar search input */
  app-chat-home {
    .sidebar-search {
      .p-input-icon-left {
        position: relative;
        display: flex;
        align-items: center;
        width: 100%;

        i {
          position: absolute;
          left: 0.75rem;
          color: rgba(255, 255, 255, 0.6) !important;
          z-index: 1;
          pointer-events: none;
        }

        input.search-input,
        input.p-inputtext,
        input.p-inputtext.search-input,
        input.search-input.p-inputtext {
          width: 100% !important;
          background: #374151 !important;
          background-color: #374151 !important;
          color: rgba(255, 255, 255, 0.87) !important;
          border: 1px solid rgba(255, 255, 255, 0.1) !important;
          border-radius: 12px !important;
          padding: 0.75rem 0.75rem 0.75rem 2.5rem !important;
          font-size: 0.9375rem !important;
          height: auto !important;
          min-height: 2.5rem !important;

          &::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
          }

          &:hover {
            background: #4b5563 !important;
            background-color: #4b5563 !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
          }

          &:focus,
          &:focus-visible {
            background: #4b5563 !important;
            background-color: #4b5563 !important;
            border-color: #818cf8 !important;
            box-shadow: 0 0 0 0.2rem rgba(129, 140, 248, 0.2) !important;
            outline: none !important;
          }
        }
      }
    }
  }
}
