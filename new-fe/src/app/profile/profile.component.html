<div class="profile-container">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="user-info">
      <h1 class="user-name">{{ currentUser?.fullName || 'User' }}</h1>
      <div class="user-details">
        <div class="user-location">
          <i class="pi pi-map-marker"></i>
          <span>{{ currentUser?.city || 'City not set' }}</span>
        </div>
        <div class="user-gender" *ngIf="currentUser?.gender">
          <i class="pi pi-user"></i>
          <span>{{ currentUser?.gender | titlecase }}</span>
        </div>
      </div>
      <p-button
        icon="pi pi-pencil"
        label="Edit Profile"
        styleClass="p-button-sm p-button-outlined"
        (onClick)="openEditDialog()">
      </p-button>
    </div>
    <div class="user-avatar">
      <p-avatar
        [label]="getUserInitials()"
        size="xlarge"
        styleClass="profile-avatar">
      </p-avatar>
    </div>
  </div>

  <!-- Main Content with Tabs -->
  <div class="main-content">
    <div class="content-area">
      <p-tabView>
        <!-- Photos Tab -->
        <p-tabPanel header="Photos">
          <div class="photos-content">
            <!-- Profile Images Section -->
            <div class="profile-images-section">
              <h3 class="section-title">PROFILE IMAGES</h3>
              <div class="visibility-info">
                <span class="visibility-label">Public</span>
              </div>

              <div class="profile-images-gallery">
                <div *ngIf="userPhotos.length === 0" class="empty-gallery">
                  <div class="empty-gallery-content">
                    <i class="pi pi-camera empty-icon"></i>
                    <p class="empty-text">
                      This gallery is still empty. This gallery is only visible to you since it is empty.
                    </p>
                    <p-fileUpload
                      mode="basic"
                      name="photo"
                      accept="image/*"
                      maxFileSize="10000000"
                      (onUpload)="onPhotoUpload($event)"
                      (onSelect)="onPhotoUpload($event)"
                      chooseLabel="Choose Photo"
                      styleClass="upload-button">
                    </p-fileUpload>
                  </div>
                </div>

                <div *ngIf="userPhotos.length > 0" class="photos-grid">
                  <div *ngFor="let photo of userPhotos" class="photo-item">
                    <img
                      [src]="getPhotoUrl(photo.id!)"
                      [alt]="photo.name"
                      class="photo-image">
                    <div class="photo-overlay">
                      <span class="photo-name">{{ photo.name }}</span>
                    </div>
                  </div>

                  <!-- Add more photos button -->
                  <div class="add-photo-item">
                    <p-fileUpload
                      mode="basic"
                      name="photo"
                      accept="image/*"
                      maxFileSize="10000000"
                      (onUpload)="onPhotoUpload($event)"
                      (onSelect)="onPhotoUpload($event)"
                      chooseLabel="+"
                      styleClass="add-photo-button">
                    </p-fileUpload>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </p-tabPanel>

        <!-- Videos Tab -->
        <p-tabPanel header="Videos">
          <div class="videos-content">
            <p>Videos content coming soon...</p>
          </div>
        </p-tabPanel>

        <!-- What's Up Tab -->
        <p-tabPanel header="What's Up">
          <div class="whats-up-content">
            <p>What's up content coming soon...</p>
          </div>
        </p-tabPanel>

        <!-- Friends Tab -->
        <p-tabPanel header="Friends">
          <div class="friends-content">
            <p>Friends content coming soon...</p>
          </div>
        </p-tabPanel>

        <!-- Groups Tab -->
        <p-tabPanel header="Groups">
          <div class="groups-content">
            <p>Groups content coming soon...</p>
          </div>
        </p-tabPanel>

        <!-- Validations Tab -->
        <p-tabPanel header="Validations">
          <div class="validations-content">
            <p>Validations content coming soon...</p>
          </div>
        </p-tabPanel>
      </p-tabView>
    </div>

    <!-- Right Sidebar -->
    <div class="right-sidebar">
      <div class="sidebar-content">
        <!-- Trial Membership -->
        <div class="sidebar-section">
          <div class="section-header">
            <i class="pi pi-star"></i>
            <span>Trial membership</span>
          </div>
        </div>

        <!-- Friends Section -->
        <div class="sidebar-section">
          <div class="section-header">
            <h4>FRIENDS {{ friends.length }}</h4>
            <p-button
              icon="pi pi-plus"
              styleClass="p-button-text p-button-sm add-friend-btn">
            </p-button>
          </div>
          <div class="friends-list">
            <div *ngFor="let friend of friends" class="friend-item">
              <div class="friend-avatar-container">
                <p-avatar
                  [label]="friend.user?.firstname?.charAt(0) || 'F'"
                  styleClass="friend-avatar">
                </p-avatar>
                <span class="online-status" [class.online]="isOnline(friend.friendId)"></span>
              </div>
              <div class="friend-info">
                <span class="friend-name">{{ friend.user?.firstname }}</span>
                <span class="friend-status" *ngIf="isOnline(friend.friendId)">Online</span>
              </div>
              <p-button
                icon="pi pi-comment"
                (onClick)="startChat(friend)"
                [rounded]="true"
                [text]="true"
                styleClass="chat-button"
                pTooltip="Chat"
                tooltipPosition="left">
              </p-button>
            </div>
            <div *ngIf="friends.length === 0" class="no-friends">
              <p>No friends yet</p>
            </div>
          </div>
        </div>

        <!-- Gender Section -->
        <div class="sidebar-section">
          <div class="section-header">
            <h4>GENDER</h4>
            <p-button
              label="Edit"
              icon="pi pi-pencil"
              (onClick)="openEditDialog()"
              styleClass="p-button-text p-button-sm">
            </p-button>
          </div>
          <div class="info-content">
            <i class="pi pi-user"></i>
            <span>{{ currentUser?.gender ? (currentUser?.gender | titlecase) : 'Not specified' }}</span>
          </div>
        </div>

        <!-- City Section -->
        <div class="sidebar-section">
          <div class="section-header">
            <h4>CITY</h4>
            <p-button
              label="Edit"
              icon="pi pi-pencil"
              (onClick)="openEditDialog()"
              styleClass="p-button-text p-button-sm">
            </p-button>
          </div>
          <div class="info-content">
            <i class="pi pi-map-marker"></i>
            <span>{{ currentUser?.city || 'Not specified' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Profile Dialog -->
<p-dialog
  [(visible)]="showEditDialog"
  header="Edit Profile"
  [modal]="true"
  [style]="{ width: '450px' }"
  [draggable]="false"
  [resizable]="false">
  
  <div class="edit-form">
    <div class="field">
      <label for="gender">Gender</label>
      <p-dropdown
        id="gender"
        [(ngModel)]="editForm.gender"
        [options]="genderOptions"
        placeholder="Select Gender"
        [style]="{ width: '100%' }">
      </p-dropdown>
    </div>

    <div class="field">
      <label for="city">City</label>
      <input
        id="city"
        type="text"
        pInputText
        [(ngModel)]="editForm.city"
        placeholder="Enter your city"
        [style]="{ width: '100%' }" />
    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      (onClick)="showEditDialog = false"
      styleClass="p-button-text">
    </p-button>
    <p-button
      label="Save"
      icon="pi pi-check"
      (onClick)="saveProfile()">
    </p-button>
  </ng-template>
</p-dialog>

<!-- Loading Spinner -->
<p-progressSpinner
  *ngIf="isLoading || isUploading"
  styleClass="loading-spinner">
</p-progressSpinner>

<!-- Toast Messages -->
<p-toast></p-toast>
<!-- Edit Profile Dialog -->
<p-dialog
  [(visible)]="showEditDialog"
  header="Edit Profile"
  [modal]="true"
  [style]="{ width: '450px' }"
  [draggable]="false"
  [resizable]="false">
  
  <div class="edit-form">
    <div class="field">
      <label for="gender">Gender</label>
      <p-dropdown
        id="gender"
        [(ngModel)]="editForm.gender"
        [options]="genderOptions"
        placeholder="Select Gender"
        [style]="{ width: '100%' }">
      </p-dropdown>
    </div>

    <div class="field">
      <label for="city">City</label>
      <input
        id="city"
        type="text"
        pInputText
        [(ngModel)]="editForm.city"
        placeholder="Enter your city"
        [style]="{ width: '100%' }" />
    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      (onClick)="showEditDialog = false"
      styleClass="p-button-text">
    </p-button>
    <p-button
      label="Save"
      icon="pi pi-check"
      (onClick)="saveProfile()">
    </p-button>
  </ng-template>
</p-dialog>

<!-- Loading Spinner -->
<p-progressSpinner
  *ngIf="isLoading || isUploading"
  styleClass="loading-spinner">
</p-progressSpinner>

<!-- Toast Messages -->
<p-toast></p-toast>

